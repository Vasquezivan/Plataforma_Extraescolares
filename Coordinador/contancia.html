<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Lista Danza</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <link rel="stylesheet" href="/Coordinador/assets/css/estiloconstancia.css" />
  <style>
    /* --- estilos iguales que antes --- */
    .formulario-constancia {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: white;
      padding: 20px 20px 40px 20px;
      border: 1px solid #ccc;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
      z-index: 1001;
      border-radius: 8px;
      max-height: 90vh;
      overflow-y: auto;
      max-width: 600px;
      width: 90%;
    }
    .formulario-constancia h2 {
      font-size: 1.5em;
      margin-bottom: 15px;
      text-align: center;
    }
    .formulario-constancia label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    .formulario-constancia input,
    .formulario-constancia textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .formulario-constancia button {
      margin-top: 15px;
      padding: 10px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
    }
    .formulario-constancia button:hover {
      background-color: #0056b3;
    }
    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
    }
  </style>
</head>
<body>
  <div class="barra-guinda"></div>
  <header>
    <div class="logos">
      <img src="/Coordinador/assets/img/educacion1.png" alt="SEP" />
      <img src="/Coordinador/assets/img/gobierno de mexico.jpeg" alt="Gobierno" />
      <img src="/Coordinador/assets/img/logo tec etla.png" alt="Tec ELA" />
      <img src="/Coordinador/assets/img/tec mex.png" alt="TECNM" />
    </div>
    <h2>
      Gobierno de México<br />
      Secretaría de Educación Pública | TecNM | IT Valle de Etla
    </h2>
  </header>
  <div class="barra-guinda"></div>

  <div class="container">
    <div class="title-bar">Lista Danza</div>
    <table>
      <thead>
        <tr>
          <th>No.</th>
          <th>Nombres y Apellidos</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="tabla-alumnos">
        <tr>
          <td>1</td>
          <td>Adán Cristóbal Cruz Espinoza</td>
          <td>
            <i class="fa-solid fa-eye" title="Ver"></i>
            <i class="fa-solid fa-pen-to-square" title="Editar"></i>
            <i class="fa-solid fa-trash" title="Eliminar"></i>
            <button
              class="btn-generar-constancia"
              onclick="mostrarFormularioEvaluacion(1)"
            >
              <i class="fa-solid fa-clipboard-check"></i> Evaluar
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div id="formularioEvaluacion" class="formulario-constancia">
    <h2>Evaluación de Actividades Complementarias</h2>
    <label for="nombreEstudianteEval">Nombre del Estudiante:</label>
    <input type="text" id="nombreEstudianteEval" readonly />

    <label for="actividadComplementaria">Actividad Complementaria:</label>
    <input type="text" id="actividadComplementaria" />

    <label for="periodo">Periodo de Realización:</label>
    <input type="text" id="periodo" />

    <fieldset>
      <legend>Criterios de Evaluación</legend>
      <div id="criteriosContainer"></div>
    </fieldset>

    <label for="observaciones">Observaciones:</label>
    <textarea id="observaciones"></textarea>

    <label for="valorNumericoEval">Valor Numérico:</label>
    <input type="number" id="valorNumericoEval" readonly />

    <label for="nivelDesempenoEval">Nivel de Desempeño:</label>
    <input type="text" id="nivelDesempenoEval" readonly />

    <hr />
    <h3>Validación Final (Segunda Hoja)</h3>
    <label for="nombreResponsable">Nombre del Profesor Responsable:</label>
    <input type="text" id="nombreResponsable" />

    <label for="nombreJefeExtra"
      >Nombre del Jefe(a) de Actividades Extraescolares:</label
    >
    <input type="text" id="nombreJefeExtra" />

    <label for="fechaExpedicion">Fecha de Expedición:</label>
    <input type="date" id="fechaExpedicion" />

    <button onclick="finalizarEvaluacion()">Finalizar Evaluación</button>
    <button onclick="cerrarFormularioEvaluacion()">Cerrar</button>
  </div>

  <div id="overlay" class="overlay"></div>

  <footer>
    &copy; 2025 Club Cultural | TecNM - Instituto Tecnológico del Valle de Etla
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const criterios = [
      "Cumple en tiempo y forma con las actividades encomendadas alcanzando los objetivo.",
      "Trabaja en equipo y se adapta a nuevas situaciones.",
      "Muestra liderazgo en las actividades encomendadas.",
      "Organiza su tiempo y trabaja de manera proactiva.",
      "Interpreta la realidad y se sensibiliza aportando soluciones a la problemática.",
      "Realiza sugerencias innovadoras para beneficio o mejora del programa.",
      "Tiene iniciativa para ayudar y muestra espíritu de servicio.",
    ];

    function mostrarFormularioEvaluacion(filaIndex) {
      const fila = document.getElementById("tabla-alumnos").rows[filaIndex - 1];
      const nombre = fila.cells[1].textContent;
      document.getElementById("formularioEvaluacion").style.display = "block";
      document.getElementById("overlay").style.display = "block";

      document.getElementById("nombreEstudianteEval").value = nombre;
      document.getElementById("actividadComplementaria").value = "";
      document.getElementById("periodo").value = "";
      document.getElementById("observaciones").value = "";
      document.getElementById("valorNumericoEval").value = "";
      document.getElementById("nivelDesempenoEval").value = "";
      document.getElementById("nombreResponsable").value = "";
      document.getElementById("nombreJefeExtra").value = "";
      document.getElementById("fechaExpedicion").value = "";

      const container = document.getElementById("criteriosContainer");
      container.innerHTML = "";
      criterios.forEach((texto, i) => {
        const div = document.createElement("div");
        div.innerHTML = `<label>${i + 1}. ${texto}</label><br>
          ${[
            "Insuficiente",
            "Suficiente",
            "Bueno",
            "Notable",
            "Excelente",
          ]
            .map(
              (nivel, idx) =>
                `<label><input type='radio' name='criterio${i}' value='${idx}'> ${nivel}</label>`
            )
            .join(" ")}<br><br>`;
        container.appendChild(div);
      });
    }

    function cerrarFormularioEvaluacion() {
      document.getElementById("formularioEvaluacion").style.display = "none";
      document.getElementById("overlay").style.display = "none";
    }

    function calcularPromedioYDesempeno() {
      let total = 0;
      let count = 0;
      for (let i = 0; i < criterios.length; i++) {
        const radios = document.getElementsByName(`criterio${i}`);
        for (const radio of radios) {
          if (radio.checked) {
            total += parseInt(radio.value);
            count++;
            break;
          }
        }
      }
      const promedio = count ? total / count : 0;
      let nivel = "";
      if (promedio >= 3.5) nivel = "Excelente";
      else if (promedio >= 2.5) nivel = "Notable";
      else if (promedio >= 1.5) nivel = "Bueno";
      else if (promedio >= 1.0) nivel = "Suficiente";
      else nivel = "Insuficiente";

      document.getElementById("valorNumericoEval").value = promedio.toFixed(2);
      document.getElementById("nivelDesempenoEval").value = nivel;
    }

    document.addEventListener("change", (e) => {
      if (e.target.name && e.target.name.startsWith("criterio")) {
        calcularPromedioYDesempeno();
      }
    });

    function finalizarEvaluacion() {
      // Preguntar si quiere generar constancia
      const quiereGenerar = confirm(
        "¿Desea generar la constancia con los datos de la evaluación?"
      );
      if (quiereGenerar) {
        generarConstanciaPDF();
      } else {
        cerrarFormularioEvaluacion();
      }
    }

    function generarConstanciaPDF() {
      // Importar la librería jsPDF
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // Recoger los datos del formulario
      const nombre = document.getElementById("nombreEstudianteEval").value;
      const actividad = document.getElementById("actividadComplementaria").value;
      const periodo = document.getElementById("periodo").value;
      const observaciones = document.getElementById("observaciones").value;
      const valorNumerico = document.getElementById("valorNumericoEval").value;
      const nivelDesempeno = document.getElementById("nivelDesempenoEval").value;
      const nombreResponsable = document.getElementById("nombreResponsable").value;
      const nombreJefeExtra = document.getElementById("nombreJefeExtra").value;
      const fechaExpedicion = document.getElementById("fechaExpedicion").value;

      // Título
      doc.setFontSize(18);
      doc.text("Constancia de Evaluación de Actividades Complementarias", 20, 20);

      doc.setFontSize(12);
      let y = 40;

      doc.text(`Nombre del Estudiante: ${nombre}`, 20, y);
      y += 10;
      doc.text(`Actividad Complementaria: ${actividad}`, 20, y);
      y += 10;
      doc.text(`Periodo de Realización: ${periodo}`, 20, y);
      y += 10;
      doc.text(`Valor Numérico: ${valorNumerico}`, 20, y);
      y += 10;
      doc.text(`Nivel de Desempeño: ${nivelDesempeno}`, 20, y);
      y += 10;
      doc.text("Observaciones:", 20, y);
      y += 10;
      // Ajustar texto largo en varias líneas si es necesario
      const splitObs = doc.splitTextToSize(observaciones, 170);
      doc.text(splitObs, 20, y);
      y += splitObs.length * 10;

      y += 10;
      doc.text(`Nombre del Profesor Responsable: ${nombreResponsable}`, 20, y);
      y += 10;
      doc.text(
        `Nombre del Jefe(a) de Actividades Extraescolares: ${nombreJefeExtra}`,
        20,
        y
      );
      y += 10;
      doc.text(`Fecha de Expedición: ${fechaExpedicion}`, 20, y);

      // Guardar PDF
      doc.save(`Constancia_${nombre.replace(/\s/g, "_")}.pdf`);

      // Cerrar formulario
      cerrarFormularioEvaluacion();
    }
  </script>
</body>
</html>
