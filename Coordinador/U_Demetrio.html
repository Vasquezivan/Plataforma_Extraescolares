<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Actividades Extraescolares Demetrio Vallejo</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- Íconos Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Arial', sans-serif;
    }

    body {
      background-color: #f5f5f5;
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 250px;
      background-color: #002147;
      color: white;
      transition: all 0.3s;
      position: fixed;
      height: 100vh;
      z-index: 1000;
    }

    .sidebar-header {
      padding: 20px;
      background-color: #001a36;
      text-align: center;
    }

    .sidebar-header h3 {
      color: white;
      font-size: 1.2em;
      margin: 0;
    }

    .sidebar-menu {
      padding: 20px 0;
    }

    .sidebar-menu ul {
      list-style: none;
    }

    .sidebar-menu li {
      position: relative;
    }
.sidebar-menu a {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 15px 20px;
  color: #b8c7ce;
  text-decoration: none;
  transition: all 0.3s;
  border-left: 3px solid transparent;
  white-space: normal;
}

.sidebar-menu a i {
  flex-shrink: 0;
  min-width: 20px;
  text-align: center;
}


    .sidebar-menu a:hover,
    .sidebar-menu a.active {
      color: white;
      background-color: #1a3a6a;
      border-left: 3px solid #ff7f00;
    }

    /* Main Content */
    .main-content {
      margin-left: 250px;
      width: calc(100% - 250px);
      transition: all 0.3s;
    }

    /* Header */
    .top-navbar {
      background-color: white;
      padding: 15px 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .toggle-sidebar {
      background: none;
      border: none;
      color: #002147;
      font-size: 20px;
      cursor: pointer;
    }

    .user-menu {
      display: flex;
      align-items: center;
    }

    .user-menu img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
    }

    .user-menu span {
      color: #002147;
      font-weight: bold;
    }

    /* Dashboard Content */
    .content-wrapper {
      padding: 20px;
    }

    .welcome-section {
      background-color: white;
      border-radius: 8px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .welcome-section h1 {
      color: #002147;
      margin-bottom: 10px;
      font-size: 28px;
    }

    .welcome-section .unidad-nombre {
      color: #ff7f00;
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 15px;
    }

    .welcome-section p {
      color: #666;
      font-size: 16px;
      line-height: 1.6;
      margin-bottom: 20px;
    }

    .stats-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
    }

    .stat-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .stat-card-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
    }

    .stat-card-icon.blue {
      background-color: #3498db;
    }

    .stat-card-icon.green {
      background-color: #2ecc71;
    }

    .stat-card-icon.orange {
      background-color: #e67e22;
    }

    .stat-card-icon.purple {
      background-color: #9b59b6;
    }

    .stat-card-title {
      color: #777;
      font-size: 14px;
      text-transform: uppercase;
      font-weight: bold;
    }

    .stat-card-value {
      color: #002147;
      font-size: 24px;
      font-weight: bold;
      margin: 10px 0;
    }

    .stat-card-footer {
      color: #777;
      font-size: 13px;
      border-top: 1px solid #eee;
      padding-top: 10px;
      margin-top: auto;
    }

    /* Logos */
    .header-main {
      background-color: #f5f5f5;
      padding: 20px 10px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
    }

    .logo-enlace img {
      height: 60px;
      transition: transform 0.2s;
    }

    .logo-enlace img:hover {
      transform: scale(1.05);
    }

    /* Footer */
    .site-footer {
      background-color: #002147;
      color: white;
      padding: 40px 0 20px;
      margin-top: 40px;
    }

    .footer-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
      gap: 30px;
    }

    .footer-text {
      flex: 1;
      min-width: 300px;
    }

    .footer-text h3 {
      color: #ff7f00;
      margin-bottom: 15px;
      font-size: 1.3em;
      font-weight: bold;
    }

    .footer-text p {
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .footer-map {
      flex: 1;
      min-width: 300px;
    }

    .footer-map iframe {
      width: 100%;
      height: 280px;
      border-radius: 8px;
      border: none;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }

    .footer-copyright {
      text-align: center;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,0.1);
      font-size: 0.9em;
      color: rgba(255,255,255,0.7);
    }

    .whatsapp-link img {
      width: 30px;
      height: 30px;
      transition: transform 0.3s;
    }

    .whatsapp-link img:hover {
      transform: scale(1.1);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        margin-left: -250px;
      }
      .sidebar.active {
        margin-left: 0;
      }
      .main-content {
        width: 100%;
        margin-left: 0;
      }
      .main-content.active {
        margin-left: 250px;
        width: calc(100% - 250px);
      }
      
      .footer-container {
        flex-direction: column;
      }
      
      .footer-map {
        order: -1;
      }
    }

        /* Icono de usuario flotante en la esquina superior derecha */
#iconoPerfilContainer {
  position: fixed;
  top: 18px;
  right: 28px;
  z-index: 10000;
}

#iconoPerfil {
  font-size: 32px;
  color: #1B396A;
  cursor: pointer;
  transition: color 0.2s, transform 0.2s;
}

#iconoPerfil:hover {
  color: #ff7f00;
  transform: scale(1.08);
}


    /* Estilos específicos para Demetrio Vallejo */
    .unidad-header {
      background-color: #002147;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 1.2em;
      margin-bottom: 20px;
    }

    /* Estilos para el contenedor de categorías */
    #categorias-container {
      max-width: 1200px;
      margin: 20px auto;
      padding: 0 20px;
    }

    .contenedor-categoria {
      margin-bottom: 30px;
    }

    .categoria {
      background-color: #002147;
      color: white;
      font-size: 18px;
      font-weight: bold;
      padding: 10px 15px;
      border-radius: 5px;
      margin-bottom: 15px;
      width: fit-content;
    }

    .actividades-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .modulo {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      padding: 15px;
      transition: transform 0.3s;
      cursor: pointer;
    }

    .modulo:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .modulo img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 5px;
      margin-bottom: 10px;
    }

    .modulo h3 {
      color: #002147;
      margin: 10px 0;
      font-size: 18px;
    }

    .modulo p {
      color: #666;
      font-size: 14px;
      margin-bottom: 10px;
    }


       .stat-card-footer {
  font-size: 13px;
  color: #555;
  margin-top: 8px;
  line-height: 1.4em;
  text-align: justify;
}
.stat-card-value {
  font-size: 20px;
  font-weight: bold;
  margin: 5px 0;
}
.stat-card {
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(84, 82, 82, 0.1);
  background: #fff;
}

  </style>
</head>
<body>
<!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h3>Actividades Extraescolares</h3>
    </div>
    <div class="sidebar-menu">
      <ul>
        <li>
          <a href="U_Demetrio.html" class="active">
            <i class="fa fa-home"></i> Inicio
          </a>
        </li>
            <li>
  <a href="VerEstudiantes.html?unidad=Unidad académica Demetrio Vallejo Martínez en el Espinal">
    <i class="fa fa-users"></i> Ver Estudiantes
  </a>
</li>
        <li>
          <a href="contancia.html">
            <i class="fa fa-file-text"></i> Constancia de Cumplimiento 
          </a>
        </li>
        <li>
          <a href="informe.html">
            <i class="fa fa-file-pdf-o"></i> Informe de Actividad
          </a>
        </li>
        <li>
          <a href="resultados.html">
            <i class="fa fa-bar-chart"></i> Resultados
          </a>
        </li>
      </ul>
    </div>
  </div>


  <!-- Main Content -->
  <div class="main-content">
    <!-- Top Navbar -->
    <div class="top-navbar">
      <button class="toggle-sidebar" id="toggle-sidebar">
        <i class="fa fa-bars"></i>
      </button>
    </div>

    <!-- Content -->
    <div class="content-wrapper">
      <!-- Logos -->
      <div class="header-main">
        <div class="logo-enlace">
          <a href="https://www.gob.mx/" target="_blank"><img src="https://vetla.tecnm.mx/wp-content/themes/TecNM-ITVE/images/pleca-GobMx.png" alt="GobMX"></a>
          <a href="https://www.gob.mx/sep" target="_blank"><img src="https://vetla.tecnm.mx/wp-content/themes/TecNM-ITVE/images/pleca-Educ.png" alt="SEP"></a>
          <a href="https://www.tecnm.mx" target="_blank"><img src="https://vetla.tecnm.mx/wp-content/themes/TecNM-ITVE/images/pleca-TecNM.png" alt="TecNM"></a>
          <a href="http://www.vetla.tecnm.mx/" target="_blank"><img src="https://vetla.tecnm.mx/wp-content/themes/TecNM-ITVE/images/pleca-ITVE.png" alt="ITVE"></a>
        </div>
      </div>

      <!-- Encabezado de unidad -->
      <div class="unidad-header">
        Tecnológico Nacional de México - Unidad Académica Demetrio Vallejo Martínez en el Espinal
      </div>

      <!-- Welcome Section -->
      <div class="welcome-section">
        <h1>Bienvenido al Sistema de Actividades Extraescolares</h1>
        <div class="unidad-nombre">Unidad Académica - Demetrio Vallejo Martínez en el Espinal</div>
        <p>Desde este panel podrás gestionar todas las actividades extraescolares de la institución, registrar estudiantes, generar constancias y visualizar reportes estadísticos.</p>
      </div>

      <!-- Stats Cards -->
<div class="stats-cards">

  <!-- Estudiantes Registrados -->
  <div class="stat-card">
    <div class="stat-card-header">
      <span class="stat-card-title">Ver Estudiantes</span>
      <div class="stat-card-icon blue">
        <i class="fa fa-users"></i>
      </div>
    </div>
    <div class="stat-card-value">01</div>
    <div class="stat-card-footer">
      Este apartado permite consultar y gestionar la información de los estudiantes registrados. 
      Desde aquí se puede verificar su participación en actividades, actualizar datos y llevar un control general.
    </div>
  </div>

  <!-- Constancia de Cumplimiento -->
  <div class="stat-card">
    <div class="stat-card-header">
      <span class="stat-card-title">Constancia de Cumplimiento</span>
      <div class="stat-card-icon orange">
        <i class="fa fa-file-text"></i>
      </div>
    </div>
    <div class="stat-card-value">02</div>
    <div class="stat-card-footer">
      Acá se generan y descargan las constancias oficiales que validan la participación de los estudiantes 
      en las actividades extraescolares.
    </div>
  </div>

  <!-- Informe de Actividad -->
  <div class="stat-card">
    <div class="stat-card-header">
      <span class="stat-card-title">Informe de Actividad</span>
      <div class="stat-card-icon green">
        <i class="fa fa-file-pdf-o"></i>
      </div>
    </div>
    <div class="stat-card-value">03</div>
    <div class="stat-card-footer">
      Esta sección permite registrar y consultar los reportes de cada actividad realizada. 
    
    </div>
  </div>

  <!-- Resultados -->
  <div class="stat-card">
    <div class="stat-card-header">
      <span class="stat-card-title">Resultados</span>
      <div class="stat-card-icon purple">
        <i class="fa fa-line-chart"></i>
      </div>
    </div>
    <div class="stat-card-value">04</div>
    <div class="stat-card-footer">
      En este apartado se visualizan los indicadores como número de estudiantes activos, 
      actividades realizadas, constancias emitidas y nivel de participación.
    </div>
  </div>

</div>

      <!-- Contenedor de categorías -->
      <div id="categorias-container"></div>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
      <div class="footer-container">
        <!-- Información de contacto -->
        <div class="footer-text">
          <h3>Dirección</h3>
          <p>Abasolo S/N, Barrio del Agua Buena<br>Santiago Suchilquitongo Oaxaca, C.P. 68230</p>
          
          <h3>Contacto</h3>
          <p>
            Email: info@vetla.tecnm.mx<br>
            Teléfono: 951 305 29 27
          </p>
          
          <h3>Preguntar por Whatsapp</h3>
          <a href="https://wa.me/9513052927?text=Buen%20d%C3%ADa%2C%20deseo%20informaci%C3%B3n%20" target="_blank" class="whatsapp-link">
            <img src="http://vetla.tecnm.mx/wp-content/uploads/2021/04/whatsapp.png" alt="Whatsapp">
          </a>
        </div>
        
        <!-- Mapa -->
        <div class="footer-map">
          <iframe 
            src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d15241.367048623282!2d-96.8702191!3d17.2506929!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x85c6e36d891967db%3A0x512f566ad941ae57!2sTecnol%C3%B3gico%20Nacional%20de%20M%C3%A9xico%20campus%20Instituto%20Tecnol%C3%B3gico%20del%20Valle%20de%20Etla!5e0!3m2!1ses!2smx!4v1621983062705!5m2!1ses!2smx"
            allowfullscreen>
          </iframe>
        </div>
      </div>
      
      <!-- Derechos reservados -->
      <div class="footer-copyright">
        <p>© 2023 Tecnológico Nacional de México - Campus Valle de Etla. Todos los derechos reservados.</p>
      </div>
    </footer>
  </div>
  <!-- Icono de usuario flotante en la esquina superior derecha -->
<div id="iconoPerfilContainer">
  <i class="fas fa-user-circle" id="iconoPerfil"></i>
</div>


  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
  document.addEventListener("DOMContentLoaded", function () {
    // 1. Cargar datos del usuario desde JSON
    function cargarUsuario() {
      fetch("php/obtener_usuario.php")
        .then((response) => {
          if (!response.ok) throw new Error("Error en la respuesta del servidor");
          return response.json(); // Asegura que el backend devuelve JSON válido
        })
        .then((data) => {
          if (data && typeof data === "object" && !Array.isArray(data)) {
            document.getElementById("nombre-usuario").textContent = data.nombre || "Usuario";
          } else {
            throw new Error("Respuesta JSON no válida");
          }
        })
        .catch((error) => {
          console.error("Error al cargar usuario:", error);
          document.getElementById("nombre-usuario").textContent = "Usuario";
        });
    }

    // 2. Cargar actividades desde JSON
    function cargarActividades() {
      const categoriasContainer = document.getElementById("categorias-container");
      categoriasContainer.innerHTML = '<div class="loading">Cargando actividades...</div>';

      const id_unidad = 1; // ID para Demetrio Vallejo

      fetch(`php/api_actividades_demetrio.php?id_unidad=${id_unidad}`)
        .then((response) => {
          if (!response.ok) throw new Error("Error en la respuesta del servidor");
          return response.json(); // Se espera JSON compatible
        })
        .then((data) => {
          categoriasContainer.innerHTML = "";

          if (!Array.isArray(data) || data.length === 0) {
            categoriasContainer.innerHTML = `
              <div class="no-activities">
                <h3>No hay actividades disponibles</h3>
                <p>No se encontraron actividades para mostrar.</p>
              </div>
            `;
            return;
          }

          data.forEach((categoria) => {
            if (!Array.isArray(categoria.actividades) || categoria.actividades.length === 0) return;

            const actividadesHTML = categoria.actividades
              .map((actividad) => {
                const imagen = actividad.imagen_url || "https://via.placeholder.com/300x150?text=Actividad";
                const nombre = actividad.nombre_actividad || "Actividad sin nombre";
                const descripcion = actividad.descripcion || "Descripción no disponible";
                const id = actividad.id_actividad || 0;

                return `
                  <div class="modulo" onclick="irADetalleActividad(${id})">
                    <img src="${imagen}" alt="${nombre}" onerror="this.src='img/actividades/default.jpg'">
                    <h3>${nombre}</h3>
                    <p>${descripcion}</p>
                  </div>
                `;
              })
              .join("");

            const categoriaHTML = `
              <div class="contenedor-categoria">
                <div class="categoria">${categoria.nombre_categoria || "Sin categoría"}</div>
                <div class="actividades-container">${actividadesHTML}</div>
              </div>
            `;

            categoriasContainer.insertAdjacentHTML("beforeend", categoriaHTML);
          });
        })
        .catch((error) => {
          console.error("Error:", error);
          categoriasContainer.innerHTML = `
            <div class="error-message">
              <h3>Error al cargar las actividades</h3>
              <p>${error.message}</p>
              <button onclick="location.reload()">Reintentar</button>
            </div>
          `;
        });
    }

    // 3. Actualizar estadísticas (JSON simulado)
    function updateStats() {
      const stats = [
        { selector: ".stat-card:nth-child(1) .stat-card-value", value: 1, isPercent: false },
        { selector: ".stat-card:nth-child(2) .stat-card-value", value: 2, isPercent: false },
        { selector: ".stat-card:nth-child(3) .stat-card-value", value: 3, isPercent: false },
        { selector: ".stat-card:nth-child(4) .stat-card-value", value: 4, isPercent: false}
      ];

      stats.forEach((stat) => {
        const element = document.querySelector(stat.selector);
        if (element) {
          element.textContent = stat.isPercent ? `${stat.value}%` : stat.value.toLocaleString();
        }
      });
    }

    // 4. Menú hamburguesa
    function setupSidebarToggle() {
      document.getElementById("toggle-sidebar").addEventListener("click", function () {
        document.querySelector(".sidebar").classList.toggle("active");
        document.querySelector(".main-content").classList.toggle("active");
      });
    }

    // Inicializar
    function init() {
      cargarUsuario();
      cargarActividades();
      updateStats();
      setupSidebarToggle();
    }

    init();
  });

  function irADetalleActividad(id) {
    window.location.href = `registro.html?id_actividad=${id}`;
  }
  // Mostrar modal de perfil al hacer clic en el icono de usuario
  document.addEventListener('DOMContentLoaded', function() {
    const iconoPerfil = document.getElementById('iconoPerfil');
    if (iconoPerfil) {
      iconoPerfil.addEventListener('click', mostrarModalPerfil);
    }
  });

  function mostrarModalPerfil() {
    // Evita duplicar el modal
    if (document.getElementById('modalPerfilUsuario')) return;

    const usuarioActual = sessionStorage.getItem('usuario') || 'Usuario Invitado';

    const modalHTML = `
      <div id="modalPerfilUsuario" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); z-index: 9999; display: flex; align-items: center; justify-content: center;">
        <div style="background: #fff; border-radius: 12px; padding: 30px 40px; min-width: 300px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); text-align: center; position: relative;">
          <i class="fas fa-user-circle" style="font-size: 60px; color: #1B396A; margin-bottom: 15px;"></i>
          <h2 style="color: #1B396A; font-size: 22px; margin-bottom: 10px;">Perfil de Usuario</h2>
          <p style="font-size: 17px; margin-bottom: 25px;"><strong>${usuarioActual}</strong></p>
          <button id="btnCerrarSesion" style="background: #d33; color: #fff; border: none; border-radius: 5px; padding: 10px 25px; font-size: 16px; font-weight: bold; cursor: pointer;">
            <i class="fas fa-sign-out-alt" style="margin-right: 7px;"></i>Cerrar Sesión
          </button>
          <button id="btnCerrarModalPerfil" style="position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 22px; color: #888; cursor: pointer;">&times;</button>
        </div>
      </div>
    `;
    document.body.insertAdjacentHTML('beforeend', modalHTML);

    document.getElementById('btnCerrarSesion').onclick = function() {
      sessionStorage.clear();
      window.location.href = '../index.html'; // Ajusta la ruta si es necesario
    };

    document.getElementById('btnCerrarModalPerfil').onclick = function() {
      document.getElementById('modalPerfilUsuario').remove();
    };

    document.getElementById('modalPerfilUsuario').onclick = function(e) {
      if (e.target === this) this.remove();
    };
  }

</script>
</body>
</html>